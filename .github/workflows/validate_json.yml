name: Validate JSON Integrity

on:
  pull_request:
    paths:
      - 'database/**/*.json'
      - 'submissions/**/*.json'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Validate JSON Syntax
        run: |
          import json
          import glob
          import sys

          # Pega arquivos das duas pastas
          files = glob.glob('database/*.json') + glob.glob('submissions/*.json')
          has_error = False

          if not files:
              print("⚠️ Nenhum arquivo JSON encontrado para validar.")
              sys.exit(0)

          for file in files:
            try:
              with open(file, 'r', encoding='utf-8') as f:
                json.load(f)
              print(f"✅ Valid: {file}")
            except Exception as e:
              print(f"❌ Invalid JSON: {file} - {e}")
              has_error = True
          
          if has_error:
            sys.exit(1)
        shell: python
